name: Cricket Tweet Bot Scheduler

on:
  schedule:
    - cron: '0 3-17 * * *'

  workflow_dispatch:
   inputs:
   custom_niche:
    description: 'Custom niche(optional)'
    required: false
    default: 'Cricket World Cup 2026'

env:
  python_env: 3.13
  DEFAULT_NICHE: 'Cricket World Cup 2026'


jobs:
  generate-and-post-tweet:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:

      - name: clone repository
        uses: actions/checkout@v4

      - name: Setup Python Environment{{ env.PYTHON_VER}
        uses: actions/setup-python@v4
        with:
          python-version: ${{env.PYTHON_VER}}

      - name: Install UV package manager
        shell: bash
  
        run: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "${HOME}/.local/bin" >> $GITHUB_PATH

      - name: ğŸ Generate and Post Tweet
        env:
          # Pull secrets from GitHub Secrets (encrypted storage)
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}
          X_BEARER_TOKEN: ${{ secrets.X_BEARER_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          TAVILY_API_KEY: ${{ secrets.TAVILY_API_KEY }}
          NICHE: ${{ inputs.custom_niche || env.DEFAULT_NICHE }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ Cricket World Cup Tweet Bot Starting"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“… UTC Time: $(date -u '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸ“Œ Topic: ${NICHE}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          uv run python run_cricket_bot.py
      
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # STEP 6: Summary (runs even if previous steps fail)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“Š Workflow Summary
        if: always()
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“Š Workflow Result: ${{ job.status }}"
          echo "â° Finished at: $(date -u '+%Y-%m-%d %H:%M:%S') UTC"